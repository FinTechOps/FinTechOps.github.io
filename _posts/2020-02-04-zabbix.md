---
layout: default
title: "Zabbix介绍"
date: 2020-02-04 10:00:00
published: 2020-02-04 10:00:00
comments: true
categories: 监控
tags: [monitor]
author: yangyang
---

<p>
监控系统是一个互联网公司非常重要的系统，它能为线上服务稳定运行提供保障。目前市面上的监控系统种类繁多，开源的企业监控产品层出不穷，比如：Zabbix、Open-Falcon、Prometheus等。在监控选型的初期，需要充分考虑到当前企业的发展现状，而本文介绍的Zabbix具有采集手段多样、安装搭建便捷、功能丰富等优点，当然也有性能瓶颈、配置复杂等缺点。

具体选型需要考虑的请参照本站另一篇文章“监控系统搭建选型”，本文主要详细介绍Zabbix的特性和搭建，以及笔者的一些心得分享。
</p>


<!--more-->

### What's Zabbix

#### 官方的描述：
```
 Zabbix是一款能够监控各种网络参数以及服务器健康性和完整性的软件。Zabbix使用灵活的通知机制，允许用户为几乎任何事件配置基于邮件的告警。这样可以快速反馈服务器的问题。基于已存储的数据，Zabbix提供了出色的报告和数据可视化功能。这些功能使得Zabbix成为容量规划的理想方案。

Zabbix支持主动轮询和被动捕获。Zabbix所有的报告、统计信息和配置参数都可以通过基于Web的前端页面进行访问。基于Web的前端页面可以确保您从任何方面评估您的网络状态和服务器的健康性。适当的配置后，Zabbix可以在IT基础架构监控方面扮演重要的角色。对于只有少量服务器的小型组织和拥有大量服务器的大型公司也同样如此。 
```
#### 优缺点:
```
Zabbix优点：

1、数据采集：可用性和性能检测，自动发现，支持agent、snmp、JMX、telnet等多种采集方式，支持主动和被动模式数据传输、支持用户自定义插件，自定义间隔收集数据

2、高可用：server对设备性能要求低，支持proxy分布式监控，分布式集中管理，有自动发现功能，可以实现自动化监控；开放式接口，扩展性强，插件编写容易

3、告警管理：支持多条件告警，支持多种告警方式，支持多组模板，模板继承。

4、告警设置：告警周期，告警级别，告警恢复通知、告警暂停，时段阈值、支持维护周期、支持单机停用

5、图形化展示：允许自定义创建多监控项视图，网络拓扑，自定义面板展示，自定义IT服务可用性

6、历史数据：历史数据查询可配置，内置housekeeping数据清理机制

7、安全审计：具备安全的用户审计日志，权限认证，用户可以限制允许维护的列表。

Zabbix缺点：

1、性能瓶颈，监控系统没有低估高峰期，具有持续性和周期性，机器量越大，数据的增大会使数据库的写入成为一定的瓶颈，官网给出的单机上限5000台，届时就需要增加proxy，增加成本。

2、Zabbix采集数据有pull方式，也就是server主动模式，当目标机器量大之后，pull任务会出现积压。采集数据会延迟

3、项目二次开发，需要分析MySQL表结构，表结构比较复杂，通过API开发对开发能力有要求。

4、内置housekeeping在执行过程中会对数据库增加压力，需要对数据库进行优化
```
### 数据采集方式

Zabbix的数据采集方式有很多种，以下介绍常用的几种：
```
1、 agent采集和上报：通过安装Zabbix-agent到目标服务器，通过server端主动发起与agent通信采集到的配置的数据。采集项多了会增加server端运行压力。
2、sender上报：通过Zabbix-sender工具，将数据上报到server端，这种方式可以减轻server端运行压力。
3、SNMP（简单网络管理协议）：监控路由器、交换机、防火墙等硬件设备时，由于无法安装agent和运行数据采集脚本，这些硬件设备都支持SNMP协议通过UDP将自身的监控数据发送到server端。
4、IPMI：监控带有IPMI硬件接口的硬件，采集硬件的IPMI数据，一般来说：IPMI数据包含电压、温度、风扇状态等
5、JMX：通过java程序的JMX端口进行监控，JMX框架在不对现有的应用做修改的情况下植入到现有的应用中，以对现有的应用的运行情况进行管理。
```
以上数据采集方式为Zabbix数据采集的主要手段，根据不同的场景下选择不同的采集方式。

笔者建议：
```
1、agent采集和上报：这种方式配置简单方便、比较稳定，配合shell或python编写相应的采集脚本可以适用大多场景，但此采集方式每个周期内server端会轮询每个采集项，服务器增多和采集项增多的话，server端的采集压力会几何增长，影响监控效率。所以建议，采集周期长、重要监控项、数据量小的监控项采取此种采集方式。
2、sender上报：这种方式需要配合shell或python编写相应的上报程序，优点为有效减轻server采集压力、上报快捷，缺点为不稳定、需要额外配置监控项关注数据上报成功与否、配置相对复杂。适用于：采集周期短、数据量大、重要性偏低的监控项。
3、SNMP，适用路由器、交换机、防火墙等硬件设备，对不同厂商或者型号需要配合对应SNMP mibs库进行配置。
4、IPMI监控仅适用于支持IPMI的设备(HP iLO, DELL DRAC, IBM RSA, Sun SSP, 等等). 
5、JMX监控需要安装Zabbix-java-gateway和开启java程序的jmx端口，一般用来采集java的性能指标。
```

### 组件介绍

#### zabbix_server

```
监控服务器，是整个Zabbix系统的核心组件，Server通过轮询采集或者接收数据，计算是否满足触发器条件，向用户发送通知。它是Zabbix监控代理和Proxy代理报告系统可用性和完整性数据的核心组件。Server自身可以通过简单服务远程检查网络服务。 
分为是三个组成部分：
1、Zabbix服务器
2、Web前端
3、数据库存储
```

#### zabbix_agent

```
Zabbix agent部署在监控的目标上，主动监测本地的资源和应用(硬件驱动，内存，处理器统计等)，分为被动（passive）和主动（active）检查，配合编写脚本可以满足绝大多数的服务器监控需求。
```

#### zabbix_sender
```
Zabbix sender是一种命令行应用，它可以将性能数据发送到Zabbix server进行处理。 该应用通常用在长时间运行的用户脚本，用于定期发送可用性和性能数据。 
```

以上组件架构图如下：

<img src="/assets/images/posts/zabbix/zabbix-server-agent.png" width="100%"/>

#### zabbix_proxy
```
当Zabbix监控的设备越来越多的时候，server端的监控压力将持续增长，这时候我们可以将监控的压力分担到另外一个组件zabbix_proxy，将设备划分到不同区域，每个区域搭建一个zabbix_proxy，zabbix_proxy收集自己所在区域的设备监控数据提交给zabbix_server。
```

架构图如下：

<img src="/assets/images/posts/zabbix/zabbix-proxy-agent.png" width="100%"/>

